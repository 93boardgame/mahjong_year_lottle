<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>桃園闆娘麻將館 - 一起慶過年</title>
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- React & ReactDOM -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  
  <!-- Babel Standalone for JSX transformation -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <!-- Firebase Configuration -->
  <script>
    // 設置 Firebase 配置
    window.__firebase_config = {
      apiKey: "AIzaSyAC3oTXktNUrgl331CU4-mnJvNm8paUywE",
      authDomain: "yermonew.firebaseapp.com",
      databaseURL: "https://yermonew-default-rtdb.firebaseio.com",
      projectId: "yermonew",
      storageBucket: "yermonew.firebasestorage.app",
      messagingSenderId: "82246020578",
      appId: "1:82246020578:web:4bb70cbcaa6067d4e61dbb",
      measurementId: "G-7LJVSRRV0M"
    };
    
    // 設置 App ID（可選）
    window.__app_id = 'default-mahjong-app';
  </script>
  
  <!-- Firebase v9 (using ES modules via dynamic import) -->
  <script type="module">
    // Load Firebase modules and make them available globally
    const firebaseApp = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js');
    const firebaseFirestore = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js');
    const firebaseAuth = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js');
    
    // Extract and expose Firebase functions
    // Firebase v9+ uses named exports, so we need to check both default and named exports
    window.firebaseApp = {
      initializeApp: firebaseApp.initializeApp || firebaseApp.default?.initializeApp
    };
    window.firebaseFirestore = {
      getFirestore: firebaseFirestore.getFirestore || firebaseFirestore.default?.getFirestore,
      collection: firebaseFirestore.collection || firebaseFirestore.default?.collection,
      addDoc: firebaseFirestore.addDoc || firebaseFirestore.default?.addDoc,
      query: firebaseFirestore.query || firebaseFirestore.default?.query,
      where: firebaseFirestore.where || firebaseFirestore.default?.where,
      getDocs: firebaseFirestore.getDocs || firebaseFirestore.default?.getDocs,
      updateDoc: firebaseFirestore.updateDoc || firebaseFirestore.default?.updateDoc,
      doc: firebaseFirestore.doc || firebaseFirestore.default?.doc,
      serverTimestamp: firebaseFirestore.serverTimestamp || firebaseFirestore.default?.serverTimestamp,
      getDoc: firebaseFirestore.getDoc || firebaseFirestore.default?.getDoc,
      orderBy: firebaseFirestore.orderBy || firebaseFirestore.default?.orderBy,
      deleteDoc: firebaseFirestore.deleteDoc || firebaseFirestore.default?.deleteDoc
    };
    
    // Debug: Log available functions
    console.log('Firebase Firestore loaded:', {
      hasCollection: !!window.firebaseFirestore.collection,
      hasGetDocs: !!window.firebaseFirestore.getDocs,
      hasAddDoc: !!window.firebaseFirestore.addDoc,
      firestoreKeys: Object.keys(firebaseFirestore)
    });
    
    // Extract all auth functions - Firebase Auth uses named exports (暫時不使用)
    window.firebaseAuth = {
      getAuth: firebaseAuth.getAuth || firebaseAuth.default?.getAuth,
      signInAnonymously: firebaseAuth.signInAnonymously || firebaseAuth.default?.signInAnonymously,
      onAuthStateChanged: firebaseAuth.onAuthStateChanged || firebaseAuth.default?.onAuthStateChanged
    };
    
    // Debug: Log available functions
    console.log('Firebase Auth loaded:', {
      hasGetAuth: !!window.firebaseAuth.getAuth,
      hasSignInAnonymously: !!window.firebaseAuth.signInAnonymously,
      hasOnAuthStateChanged: !!window.firebaseAuth.onAuthStateChanged,
      firebaseAuthKeys: Object.keys(firebaseAuth)
    });
    
    // Load lucide-react icons
    try {
      const lucideReact = await import('https://esm.sh/lucide-react');
      // Extract individual icon components
      window.lucideReact = {
        Loader2: lucideReact.Loader2,
        Ticket: lucideReact.Ticket,
        Gift: lucideReact.Gift,
        History: lucideReact.History,
        CheckCircle: lucideReact.CheckCircle,
        XCircle: lucideReact.XCircle,
        Search: lucideReact.Search,
        LayoutGrid: lucideReact.LayoutGrid
      };
    } catch (e) {
      console.warn('Failed to load lucide-react icons:', e);
      window.lucideReact = {};
    }
    
    // Trigger app load after dependencies are ready
    window.firebaseReady = true;
    console.log('Firebase modules loaded successfully');
    
    // 觸發 Firebase 初始化
    if (window.initFirebaseWhenReady) {
      window.initFirebaseWhenReady();
    }
    
    if (window.loadApp) window.loadApp();
  </script>
</head>
<body>
  <div id="root">
    <div style="display: flex; justify-content: center; align-items: center; height: 100vh; font-family: sans-serif;">
      <div style="text-align: center;">
        <div style="margin-bottom: 1rem;">載入中...</div>
        <div style="border: 4px solid #f3f4f6; border-top: 4px solid #3498db; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 0 auto;"></div>
      </div>
              </div>
          </div>

  <style>
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
  
  <!-- Load the React App -->
  <script type="text/babel" data-presets="react" src="index.jsx"></script>
  
  <!-- Initialize the App -->
  <script type="text/babel" data-presets="react">
    const { createRoot } = ReactDOM;
    
    window.loadApp = function() {
      if (!window.firebaseReady || !window.App) {
        setTimeout(window.loadApp, 100);
        return;
      }
      
      const root = createRoot(document.getElementById('root'));
      root.render(React.createElement(window.App));
    };
    
    // Start loading when script is ready
    if (window.firebaseReady) {
      window.loadApp();
    }
  </script>
</body>
</html>
